<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head('store - 콘아롱 책방')"/>
<body>
<div id='wrap'>
	<section>
		<div th:if="${type.equals('all')}">
			<div class="container" th:replace="fragments/common :: menu('allBook')"/>
		</div>
		<div th:if="${type.equals('korea')}">
			<div class="container" th:replace="fragments/common :: menu('KoreaBook')"/>
		</div>
		<div th:if="${type.equals('foreign')}">
			<div class="container" th:replace="fragments/common :: menu('foreignBook')"/>
		</div>

		<!-- 본문 -->
		<div class="container pt-4">
			<h3 class="pb-4 font-italic" th:if="${type.equals('all')}" >모든 도서</h3>
			<h3 class="pb-4 font-italic" th:if="${type.equals('korea')}" >국내 도서</h3>
			<h3 class="pb-4 font-italic" th:if="${type.equals('foreign')}" >외국 도서</h3>
			<!-- 게시글 검색 -->
			<div class="d-flex">
				<div class="mr-auto"></div>
				<strong class="mr-5" th:if="${type.equals('all')}">* 모든도서 내에서 검색하기</strong>
				<strong class="mr-5" th:if="${type.equals('korea')}">* 국내도서 내에서 검색하기</strong>
				<strong class="mr-5" th:if="${type.equals('foreign')}">* 외국도서 내에서 검색하기</strong>
			</div>
			<form class="form-inline d-flex" method="get" th:action="@{/store}">
				<div class="mr-auto p-2">총 건수 : <span th:text="${bookDtoList.totalElements}"></span></div>
				<div class="form-group mx-sm-2 mb-2">
					<input type="hidden" name="type" th:value="${param.type}">
					<input type="text" class="form-control form-control-sm" id="searchTerm" name="searchTerm" th:value="${param.searchTerm}">
				</div>
				<button type="submit" class="btn btn-sm mr-2 mb-2 btn-outline-secondary">검색</button>
			</form>
			<!-- // 게시글 검색 -->
			<div class="row mb-2">
				<div class="col-md-6 mb-3" th:each="bookDto : ${bookDtoList}">
					<div class="row no-gutters border rounded overflow-hidden mb-3">

						<div class="col-sm-8 d-flex flex-column bd-highlight">
							<div class="mx-2 pt-2">
								<span style="font-weight: bold" th:if="${bookDto.type.toString().equals('DOMESTIC')}">국내도서</span>
								<span style="font-weight: bold" th:if="${bookDto.type.toString().equals('INTERNATIONAL')}">외국도서</span>
							</div>
							<div class="mx-2 pt-2">
								<a style="text-decoration:none" th:href="@{/store/{bookId}(bookId=${bookDto.id})}">
									<h3 style="font-weight: bold" th:text="${bookDto.title}">제목</h3>
								</a>
							</div>
							<div class="mx-2">
								<a style="text-decoration:none" th:href="@{/store/{bookId}(bookId=${bookDto.id})}">
									<span class="text-muted" th:text="${bookDto.subTitle}">부제목</span>
								</a>
							</div>
							<div class="mx-2">
								<small class="text-muted" th:text="${bookDto.author} + ' 지음'">작가</small>
							</div>
							<div class="mx-2 mb-auto">
								<small class="text-muted" th:text="'발행일 : ' + ${bookDto.publishedDate}">발행일</small>
							</div>
							<div class="mx-2 pb-2">
								<hr class="mb-2">
								<span th:text="'판매가 : ' + ${#numbers.formatInteger(bookDto.disPrice, 0, 'COMMA')} + '원'">가격</span>
								<small class="mx-0" style="color: #dc3545" th:text="|(${bookDto.disRate}% 할인)|">할인률</small>
							</div>
							<div class="mx-2 pb-2">
								<button href="#" type="button" class="btn btn-sm btn-outline-secondary" th:onclick="|addBasket(${bookDto.id})|">장바구니</button>
								<button href="#" type="button" class="btn btn-sm btn-outline-success">구매하기</button>
							</div>
						</div>

						<div class="col-sm-4">
							<a th:href="@{/store/{bookId}(bookId=${bookDto.id})}">
								<img style="width: -webkit-fill-available; height: 248px; border:solid 3px; border-color:#6c757d;"
								     th:if="${!bookDto.thumbnailType.contains('http:')}" th:src="'/files/' + ${bookDto.thumbnailType}"/>
								<img style="width: -webkit-fill-available; height: 248px; border:solid 3px; border-color:#6c757d;"
								     th:if="${bookDto.thumbnailType.contains('http:')}" th:src="${bookDto.thumbnailType}"/>
							</a>
						</div>
					</div>
				</div>
			</div>
			<!--// 본문 -->

			<!-- 페이징 처리 -->
			<nav aria-label="Page navigation example">
				<ul class="pagination justify-content-center">
					<li class="page-item" th:classappend="${1 == bookDtoList.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link" th:href="@{/store(type=${param.type}, page=${bookDtoList.pageable.pageNumber}-1, searchTerm=${param.searchTerm})}" tabindex="-1" aria-disabled="true">이전</a>
					</li>
					<li class="page-item" th:classappend="${page == bookDtoList.pageable.pageNumber + 1} ? 'disabled'" th:each="page : ${#numbers.sequence(startPage, endPage)}">
						<a class="page-link" th:href="@{/store(type=${param.type}, page=${page} - 1, searchTerm=${param.searchTerm})}" th:text="${page}">1</a>
					</li>
					<li class="page-item" th:classappend="${bookDtoList.totalPages == bookDtoList.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link" th:href="@{/store(type=${param.type}, page=${bookDtoList.pageable.pageNumber} + 1, searchTerm=${param.searchTerm})}">다음</a>
					</li>
				</ul>
			</nav>
			<!-- // 페이징 처리 -->

		</div>
	</section>
	<footer class="blog-footer" th:replace="fragments/common :: footer"/>
</div>
</body>
<script>
    /* 장바구니 담기 api */
    function addBasket(bookId) {
        let cnt = 1;
        if(confirm("장바구니에 담으시겠습니까?") == true){
	        $.ajax({
	            url: '/api/basket/' + bookId,
	            type: 'post',
	            data: {
	                cnt : parseInt(cnt)
	            },
	            success: function () {
	                alert("장바구니에 추가되었습니다")
	            },
	            error: function () {
	                console.error();
	                alert("post error");
	            }
	        });
        }
    };
</script>
</html>
