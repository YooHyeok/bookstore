<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="fragments/common :: head('store - 콘아롱 책방')"/>
<body>
<div id='wrap'>
	<section>
		<div class="container" th:replace="fragments/common :: menu('adminBook')"/>
		<div class="container pt-4">
			<h3 class="pb-4 font-italic">
				ALL ITEMS
			</h3>

			<form class="pb-1 form-inline d-flex" method="get">
				<div class="mr-auto p-2">총 건수 : <span th:text="${bookDtoList.size}"></span></div>
				<a href="#" class="btn btn mr-2 mb-2 btn-outline-secondary" id="korea" th:onclick="|crawling(this)|">국내도서 크롤링</a>
				<a href="#" class="btn btn mr-2 mb-2 btn-outline-secondary" id="foreign" th:onclick="|crawling(this)|">외국도서 크롤링</a>
				<a th:href="@{/admin/book/addForm}" class="btn btn mr-2 mb-2 btn-outline-secondary">책 수동 등록하기</a>
			</form>

			<div class="table-responsive">
				<table class="table table-striped table-sm">
					<thead>
					<tr>
						<th class="pl-3">번호</th>
						<th>분류</th>
						<th>제목</th>
						<th class="pl-4">작가</th>
						<th class="pl-4">출판사</th>
						<th>수량</th>
						<th>등록인</th>
						<th>등록일</th>
						<th><a style="text-decoration:none" class="d-flex justify-content-center">관리</a></th>
					</tr>
					</thead>
					<tbody>
					<tr th:each="book : ${bookDtoList}">
						<td class="col-1 pl-4" th:text="${book.id}">번호</td>
						<td class="col-1" th:if="${book.type.toString() == 'DOMESTIC'}">국내도서</td>
						<td class="col-1" th:if="${book.type.toString() == 'INTERNATIONAL'}">외국도서</td>
						<td class="col-2" th:text="${book.title}">제목</td>
						<td class="col-2 pl-4" th:text="${book.author}">작가</td>
						<td class="col-2 pl-4" th:text="${book.publisher}">출판사</td>
						<td class="col-1" th:text="${book.quantity}">수량</td>
						<td class="col-1"th:text="${book.uid}">등록인</td>
						<td class="col-1"th:text="${book.regDate}">등록일</td>
						<td class="col-1"><a style="text-decoration:none" class="d-flex justify-content-center" th:href="@{/admin/book/{bookId}(bookId=${book.id})}">상세</a></td>
					</tr>
					</tbody>
				</table>
			</div>

			<!-- 페이징 처리 -->
			<nav aria-label="Page navigation example">
				<ul class="pagination justify-content-center">
					<li class="page-item" th:classappend="${1 == bookDtoList.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link" th:href="@{/admin/book(page=${bookDtoList.pageable.pageNumber}-1, searchTerm=${param.searchTerm})}" tabindex="-1" aria-disabled="true">이전</a>
					</li>
					<li class="page-item" th:classappend="${page == bookDtoList.pageable.pageNumber + 1} ? 'disabled'" th:each="page : ${#numbers.sequence(startPage, endPage)}">
						<a class="page-link" th:href="@{/admin/book(page=${page} - 1, searchTerm=${param.searchTerm})}" th:text="${page}">1</a>
					</li>
					<li class="page-item" th:classappend="${bookDtoList.totalPages == bookDtoList.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link" th:href="@{/admin/book(page=${bookDtoList.pageable.pageNumber} + 1, searchTerm=${param.searchTerm})}">다음</a>
					</li>
				</ul>
			</nav>
			<!-- // 페이징 처리 -->

		</div>
	</section>
	<footer th:replace="fragments/common :: footer"/>
</div>
</body>
<script>
	/* 국내도서 크롤링 */
	function crawling(e){
	    let type = e.id;
	    let typeText;
	    if(type == 'korea'){
            typeText = '국내도서';
	    }else if(type == 'foreign'){
            typeText = '외국도서';
	    }else{
	        return;
	    }
	    if(confirm(typeText+"를 크롤링 하시겠습니까?") == true){
	        $.ajax({
		        url: '/api/crawling/' + type,
		        type: 'POST',
		        success: function (){
		            alert("크롤링이 성공적으로 완료되었습니다")
			        window.location.href = '/admin/book';
		        },
		        error: function (){
		            alert("크롤링 실패")
		        }
	        });
	    }
	}
</script>
</html>
